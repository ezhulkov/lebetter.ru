<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    <changeSet author="ahomyakov" id="1.1.0-1">
        <!--in some cases user agent string is longer then 128 chars-->
        <sql>
            ALTER TABLE app_online_users ALTER useragent TYPE character varying(128);
        </sql>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-2">
        <createTable schemaName="public" tableName="app_shop">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_shop_pkey"/>
            </column>
            <column defaultValueBoolean="false" name="objectdeleted" type="bool"/>
            <column defaultValueNumeric="0" name="objectstatus" type="int4">
                <constraints nullable="false"/>
            </column>


            <column defaultValueNumeric="0.0" name="rating" type="FLOAT4(8,8)"/>
            <column defaultValueNumeric="0" name="imagestatus" type="int4"/>
            <column defaultValueNumeric="0" name="searchstatus" type="int4"/>

            <column name="creator_id" type="int8"/>
            <column name="owner_id" type="int8"/>

            <column name="name" type="VARCHAR(128)"/>
            <column name="description" type="VARCHAR(128)"/>
            <column name="site" type="VARCHAR(128)"/>
            <column name="phone_number" type="VARCHAR(128)"/>

            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>
        </createTable>


        <createTable schemaName="public" tableName="app_branch_store">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_branch_store_pkey"/>
            </column>
            <column defaultValueBoolean="false" name="objectdeleted" type="bool"/>
            <column defaultValueNumeric="0" name="objectstatus" type="int4">
                <constraints nullable="false"/>
            </column>


            <column defaultValueNumeric="0.0" name="rating" type="FLOAT4(8,8)"/>
            <column defaultValueNumeric="0" name="imagestatus" type="int4"/>
            <column defaultValueNumeric="0" name="searchstatus" type="int4"/>

            <column name="creator_id" type="int8"/>
            <column name="owner_id" type="int8"/>

            <column name="shop_id" type="int8"/>

            <column name="name" type="VARCHAR(128)"/>
            <column name="description" type="VARCHAR(128)"/>


            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>

            <!--address-->
            <column defaultValue="" name="addinfo" type="VARCHAR(4000)"/>
            <column defaultValue="" name="address" type="VARCHAR(128)"/>
            <column defaultValue="" name="city" type="VARCHAR(64)"/>
            <column defaultValue="" name="country" type="VARCHAR(64)"/>
            <column defaultValue="" name="email" type="VARCHAR(64)"/>
            <column defaultValue="" name="site" type="VARCHAR(64)"/>
            <column defaultValue="" name="telfax" type="VARCHAR(32)"/>
            <column defaultValue="" name="telfixed" type="VARCHAR(32)"/>
            <column defaultValue="" name="telmobile" type="VARCHAR(32)"/>
            <column defaultValue="" name="zipcode" type="VARCHAR(10)"/>

            <column defaultValue="" name="map_name" type="VARCHAR(128)"/>
            <column defaultValueNumeric="0.0" name="uppercornerlatitude" type="FLOAT4(8,8)"/>
            <column defaultValueNumeric="0.0" name="uppercornerlongitude" type="FLOAT4(8,8)"/>
            <column defaultValueNumeric="0.0" name="lowercornerlatitude" type="FLOAT4(8,8)"/>
            <column defaultValueNumeric="0.0" name="lowercornerlongitude" type="FLOAT4(8,8)"/>

            <column name="object_on_map_name" type="VARCHAR(128)"/>
            <column name="object_on_map_description" type="VARCHAR(128)"/>
            <column defaultValueNumeric="0.0" name="latitude" type="FLOAT4(8,8)"/>
            <column defaultValueNumeric="0.0" name="longitude" type="FLOAT4(8,8)"/>

        </createTable>

    </changeSet>


    <changeSet author="ahomyakov" id="1.1.0-3">
        <createIndex tableName="app_shop" indexName="app_shop_idx1">
            <column name="id"/>
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="rootobject"/>
        </createIndex>
        <createIndex tableName="app_branch_store" indexName="app_branch_store_idx1">
            <column name="id"/>
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="rootobject"/>
        </createIndex>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-4">
        <addForeignKeyConstraint baseTableName="app_branch_store"
                                 baseColumnNames="shop_id"
                                 referencedTableName="app_shop"
                                 referencedColumnNames="id"
                                 constraintName="app_branch_store_shop"/>
        <addForeignKeyConstraint baseTableName="app_branch_store"
                                 baseColumnNames="creator_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_branch_store_creator"/>
        <addForeignKeyConstraint baseTableName="app_branch_store"
                                 baseColumnNames="remover_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_branch_store_remover"/>
        <addForeignKeyConstraint baseTableName="app_branch_store"
                                 baseColumnNames="owner_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_branch_store_owner"/>
        <addForeignKeyConstraint baseTableName="app_branch_store"
                                 baseColumnNames="language_id"
                                 referencedTableName="app_language"
                                 referencedColumnNames="id"
                                 constraintName="app_branch_store_language"/>

        <addForeignKeyConstraint baseTableName="app_shop"
                                 baseColumnNames="creator_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_shop_creator"/>
        <addForeignKeyConstraint baseTableName="app_shop"
                                 baseColumnNames="remover_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_shop_remover"/>
        <addForeignKeyConstraint baseTableName="app_shop"
                                 baseColumnNames="owner_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_shop_owner"/>
        <addForeignKeyConstraint baseTableName="app_shop"
                                 baseColumnNames="language_id"
                                 referencedTableName="app_language"
                                 referencedColumnNames="id"
                                 constraintName="app_shop_language"/>
    </changeSet>
    <changeSet author="ahomyakov" id="1.1.0-5">
        <addColumn tableName="app_shop">
            <column name="annotation" type="VARCHAR(255)"/>
        </addColumn>
        <sql>
            ALTER TABLE app_shop ALTER description TYPE character varying(4000);
        </sql>
    </changeSet>
    <changeSet author="ahomyakov" id="1.1.0-6">
        <addColumn tableName="app_language">
            <column name="default_language" type="bool" defaultValueBoolean="false"/>
        </addColumn>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-7">
        <createTable schemaName="public" tableName="app_brand">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true"
                             primaryKeyName="app_brand_pkey"/>
            </column>
            <column defaultValueBoolean="false" name="objectdeleted" type="bool"/>
            <column defaultValueNumeric="0" name="objectstatus" type="int4">
                <constraints nullable="false"/>
            </column>


            <column defaultValueNumeric="0.0" name="rating" type="FLOAT4(8,8)"/>
            <column defaultValueNumeric="0" name="imagestatus" type="int4"/>
            <column defaultValueNumeric="0" name="searchstatus" type="int4"/>

            <column name="creator_id" type="int8"/>
            <column name="owner_id" type="int8"/>

            <column name="name" type="VARCHAR(128)"/>
            <column name="annotation" type="VARCHAR(128)"/>
            <column name="description" type="VARCHAR(4000)"/>


            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>
        </createTable>
        <createIndex tableName="app_brand" indexName="app_brand_idx1">
            <column name="id"/>
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="rootobject"/>
        </createIndex>

        <addForeignKeyConstraint baseTableName="app_brand"
                                 baseColumnNames="creator_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_brand_creator"/>
        <addForeignKeyConstraint baseTableName="app_brand"
                                 baseColumnNames="remover_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_brand_remover"/>
        <addForeignKeyConstraint baseTableName="app_brand"
                                 baseColumnNames="owner_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_brand_owner"/>
        <addForeignKeyConstraint baseTableName="app_brand"
                                 baseColumnNames="language_id"
                                 referencedTableName="app_language"
                                 referencedColumnNames="id"
                                 constraintName="app_brand_language"/>

        <createTable tableName="app_brand_shop" schemaName="public">
            <column name="shop_id" type="int8">
                <constraints nullable="false"/>
            </column>
            <column name="brand_id" type="int8">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="app_brand_shop"
                                 baseColumnNames="brand_id"
                                 referencedTableName="app_brand"
                                 referencedColumnNames="id"
                                 constraintName="app_brand_shop_brand"/>
        <addForeignKeyConstraint baseTableName="app_brand_shop"
                                 baseColumnNames="shop_id"
                                 referencedTableName="app_shop"
                                 referencedColumnNames="id"
                                 constraintName="app_brand_shop_shop"/>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-8">
        <createIndex tableName="app_shop" indexName="app_shop_idx2">
            <column name="lower(name)"/>
        </createIndex>
        <createIndex tableName="app_brand" indexName="app_brand_idx2">
            <column name="lower(name)"/>
        </createIndex>
    </changeSet>

    <changeSet author="ezhulkov" id="1.1.0-8.1">
        <comment>Table for comments</comment>
        <createTable tableName="app_rating" schemaName="public">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_rating_pkey"/>
            </column>
            <column name="objectdeleted" type="bool" defaultValueBoolean="false"/>
            <column name="objectstatus" type="int4" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="objectid" type="int8"/>
            <column name="objecttype" type="VARCHAR(255)"/>
            <column name="comment" type="VARCHAR(512)"/>
            <column name="name" type="VARCHAR(128)"/>
            <column name="creatoraltname" type="VARCHAR(255)"/>
            <column name="creatorextkey" type="VARCHAR(255)"/>
            <column name="date" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="rate" type="FLOAT4(8,8)" defaultValueNumeric="0.0"/>
            <column name="creator_id" type="int8"/>
            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>
            <column name="searchstatus" type="int4" defaultValueNumeric="0"/>
            <column name="censored" type="boolean" defaultValueBoolean="false"/>
            <column name="censored_by_admin" type="boolean" defaultValueBoolean="false"/>
            <column name="parent_id" type="int8"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="app_rating"
                                 baseColumnNames="parent_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_rating"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_rating_hierarchy"
                                 deferrable="false" initiallyDeferred="false"/>
        <addForeignKeyConstraint baseTableName="app_rating"
                                 baseColumnNames="creator_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_rating_creator"
                                 deferrable="false" initiallyDeferred="false"/>
        <addForeignKeyConstraint baseTableName="app_rating"
                                 baseColumnNames="remover_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_rating_remover"
                                 deferrable="false" initiallyDeferred="false"/>
        <addForeignKeyConstraint baseTableName="app_rating"
                                 baseColumnNames="language_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_language"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_rating_language"
                                 deferrable="false" initiallyDeferred="false"/>

        <createIndex tableName="app_rating" indexName="app_rating_idx1" tablespace="ksdb_idx">
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="deletiondate"/>
        </createIndex>
        <createIndex tableName="app_rating" indexName="app_rating_idx2" tablespace="ksdb_idx">
            <column name="objecttype"/>
            <column name="objectid"/>
        </createIndex>
        <createIndex tableName="app_rating" indexName="app_rating_idx3" tablespace="ksdb_idx">
            <column name="rate"/>
        </createIndex>
        <createIndex tableName="app_rating" indexName="app_rating_idx4" unique="true" tablespace="ksdb_idx">
            <column name="rootid"/>
            <column name="rootobject"/>
            <column name="language_id"/>
        </createIndex>

    </changeSet>

    <changeSet author="ezhulkov" id="1.1.0-9">

        <comment>Table for products</comment>
        <createTable schemaName="public" tableName="app_product">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_object_pkey"/>
            </column>
            <column name="objectdeleted" type="bool" defaultValueBoolean="false"/>
            <column name="objectstatus" type="int4" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="searchstatus" type="int4" defaultValueNumeric="0"/>
            <column name="language_id" type="int8"/>
            <column name="remover_id" type="int8"/>
            <column name="creator_id" type="int8"/>
            <column name="owner_id" type="int8"/>
            <column name="creatorrep_id" type="int8"/>

            <column name="name" type="varchar(64)"/>
            <column name="price" type="float4(6,2)" defaultValueNumeric="0.0"/>
            <column name="novelty" type="boolean" defaultValueBoolean="false"/>
            <column name="weekmark" type="boolean" defaultValueBoolean="false"/>
            <column name="articul" type="varchar(32)"/>
            <column name="rating" type="float4(8,8)" defaultValueNumeric="0.0"/>
            <column name="description" type="varchar(512)"/>
            <column name="category_id" type="int8"/>
            <column name="shop_id" type="int8"/>
            <column name="searchcommercialdatestart" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="searchcommercialdatefinish" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="searchprioritydatestart" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="searchprioritydatefinish" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="creationdate" type="TIMESTAMP WITH TIME ZONE" defaultValueDate="now()"/>
            <column name="categoryvalue" type="varchar(512)"/>
            <column name="tagsvalue" type="varchar(512)"/>
            <column name="alt" type="varchar(256)"/>
            <column name="title" type="varchar(256)"/>
            <column name="keywords" type="varchar(512)"/>
            <column name="imageurl" type="varchar(128)"/>

        </createTable>

        <addForeignKeyConstraint baseTableName="app_product"
                                 baseColumnNames="language_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_language"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_product_language"
                                 deferrable="false" initiallyDeferred="false"/>
        <addForeignKeyConstraint baseTableName="app_product"
                                 baseColumnNames="remover_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_product_remover"
                                 deferrable="false" initiallyDeferred="false"/>
        <addForeignKeyConstraint baseTableName="app_product"
                                 baseColumnNames="creator_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_product_creator"
                                 deferrable="false" initiallyDeferred="false"/>
        <addForeignKeyConstraint baseTableName="app_product"
                                 baseColumnNames="creatorrep_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_product_creatorrep"
                                 deferrable="false" initiallyDeferred="false"/>
        <addForeignKeyConstraint baseTableName="app_product"
                                 baseColumnNames="owner_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_product_owner"
                                 deferrable="false" initiallyDeferred="false"/>
        <addForeignKeyConstraint baseTableName="app_product"
                                 baseColumnNames="category_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_product_category"
                                 deferrable="false" initiallyDeferred="false"/>
        <addForeignKeyConstraint baseTableName="app_product"
                                 baseColumnNames="shop_id"
                                 baseTableSchemaName="public"
                                 referencedTableName="app_shop"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="public"
                                 constraintName="app_product_shop"
                                 deferrable="false" initiallyDeferred="false"/>

        <createIndex tableName="app_product" indexName="app_product_idx1" tablespace="ksdb_idx">
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="deletiondate"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx2" tablespace="ksdb_idx">
            <column name="lower(name)"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx3" tablespace="ksdb_idx">
            <column name="lower(articul)"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx4" tablespace="ksdb_idx">
            <column name="rating"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx5" unique="true" tablespace="ksdb_idx">
            <column name="rootid"/>
            <column name="rootobject"/>
            <column name="language_id"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx6" tablespace="ksdb_idx">
            <column name="searchstatus"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx7" tablespace="ksdb_idx">
            <column name="searchcommercialdatestart"/>
            <column name="searchcommercialdatefinish"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx8" tablespace="ksdb_idx">
            <column name="searchprioritydatestart"/>
            <column name="searchprioritydatefinish"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx9" tablespace="ksdb_idx">
            <column name="price"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx10" tablespace="ksdb_idx">
            <column name="categoryvalue"/>
        </createIndex>
        <createIndex tableName="app_product" indexName="app_product_idx11" tablespace="ksdb_idx">
            <column name="tagsvalue"/>
        </createIndex>

    </changeSet>

    <changeSet author="ezhulkov" id="1.1.0-10">

        <createTable schemaName="public" tableName="app_product_photo">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true"
                             primaryKeyName="app_product_photo_pkey"/>
            </column>
            <column defaultValueBoolean="false" name="objectdeleted" type="bool"/>
            <column defaultValueNumeric="0" name="objectstatus" type="int4">
                <constraints nullable="false"/>
            </column>

            <column defaultValueNumeric="0.0" name="rating" type="FLOAT4(8,8)"/>
            <column defaultValueNumeric="0" name="searchstatus" type="int4"/>

            <column name="creator_id" type="int8"/>

            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>

            <column name="name" type="VARCHAR(64)"/>
            <column name="imageurl" type="VARCHAR(128)"/>
            <column name="product_id" type="int8"/>

        </createTable>

        <createIndex tableName="app_product_photo" indexName="app_product_photo_idx1">
            <column name="id"/>
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="rootobject"/>
        </createIndex>

        <addForeignKeyConstraint baseTableName="app_product_photo"
                                 baseColumnNames="creator_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_product_photo_creator"/>
        <addForeignKeyConstraint baseTableName="app_product_photo"
                                 baseColumnNames="remover_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_product_photo_remover"/>
        <addForeignKeyConstraint baseTableName="app_product_photo"
                                 baseColumnNames="language_id"
                                 referencedTableName="app_language"
                                 referencedColumnNames="id"
                                 constraintName="app_product_photo_language"/>
        <addForeignKeyConstraint baseTableName="app_product_photo"
                                 baseColumnNames="product_id"
                                 referencedTableName="app_product"
                                 referencedColumnNames="id"
                                 constraintName="app_product_photo_product"/>

    </changeSet>

    <changeSet author="ezhulkov" id="1.1.0-11">
        <addColumn tableName="app_shop">
            <column name="creatorrep_id" type="int8"/>
        </addColumn>
        <addForeignKeyConstraint baseTableName="app_shop"
                                 baseColumnNames="creatorrep_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="app_shop_creator_rep"/>
    </changeSet>

    <changeSet author="ezhulkov" id="1.1.0-12">
        <addColumn tableName="app_brand">
            <column name="site" type="varchar(64)"/>
        </addColumn>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-14">
        <createTable schemaName="public" tableName="app_color">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_color_pkey"/>
            </column>
            <column defaultValueBoolean="false" name="objectdeleted" type="bool"/>
            <column defaultValueNumeric="0" name="objectstatus" type="int4">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(64)"/>
            <column name="colorcode" type="VARCHAR(7)"/>
            <column name="name" type="VARCHAR(128)"/>
            <column defaultValueBoolean="false" name="uicolor" type="bool"/>
            <column name="creator_id" type="int8"/>
            <column name="owner_id" type="int8"/>
            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>
            <column defaultValueNumeric="0" name="searchstatus" type="int4"/>
            <column name="creatorrep_id" type="int8"/>
        </createTable>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-15">
        <addForeignKeyConstraint baseColumnNames="owner_id"
                                 baseTableName="app_color"
                                 baseTableSchemaName="public"
                                 constraintName="fk6cef2fc5106f1cce"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="creator_id"
                                 baseTableName="app_color"
                                 baseTableSchemaName="public"
                                 constraintName="fk6cef2fc5ff8470b5"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="remover_id"
                                 baseTableName="app_color"
                                 baseTableSchemaName="public"
                                 constraintName="fk_colorremover"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="language_id"
                                 baseTableName="app_color"
                                 baseTableSchemaName="public"
                                 constraintName="fk_colorlang"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_language"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="creatorrep_id"
                                 baseTableName="app_color"
                                 baseTableSchemaName="public"
                                 constraintName="app_color_creatorrep_id"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-16">
        <!-- app_color indexes -->
        <createIndex tableName="app_color" unique="true" indexName="app_color_idx1" tablespace="ksdb_idx">
            <column name="lower(name)"/>
            <column name="objectdeleted"/>
            <column name="language_id"/>
        </createIndex>
        <createIndex tableName="app_color" indexName="app_color_idx2" tablespace="ksdb_idx">
            <column name="code"/>
        </createIndex>
        <createIndex tableName="app_color" indexName="app_color_idx3" tablespace="ksdb_idx">
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="deletiondate"/>
        </createIndex>
        <createIndex tableName="app_color" indexName="app_color_idx4" tablespace="ksdb_idx">
            <column name="uicolor"/>
        </createIndex>
        <createIndex tableName="app_color" indexName="app_color_idx5" unique="true" tablespace="ksdb_idx">
            <column name="rootid"/>
            <column name="rootobject"/>
            <column name="language_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-17">
        <createTable schemaName="public" tableName="app_category">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_category_pkey"/>
            </column>
            <column name="objectdeleted" type="bool" defaultValueBoolean="false" />
            <column name="objectstatus" type="int4" defaultValueNumeric="0" >
                <constraints nullable="false"/>
            </column>
            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="creator_id" type="int8"/>
            <column name="owner_id" type="int8"/>
            <column name="language_id" type="int8"/>
            <column name="remover_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="searchstatus" type="int4" defaultValueNumeric="0" />

            <column name="comment" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(128)"/>
            <column name="parent_id" type="int8"/>
            <column name="alias" type="varchar(128)"/>
            <column name="emptyflag" type="boolean" defaultValueBoolean="true"/>
            <column name="position" type="int4" defaultValueNumeric="0"/>
            
        </createTable>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-18">
        <createTable schemaName="public" tableName="app_property">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_property_pkey"/>
            </column>
            <column defaultValueBoolean="false" name="objectdeleted" type="bool"/>
            <column defaultValueNumeric="0" name="objectstatus" type="int4">
                <constraints nullable="false"/>
            </column>
            <column name="owner_id" type="int8"/>
            <column name="creator_id" type="int8"/>
            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>
            <column name="searchstatus" type="int4" defaultValueNumeric="0" />
            <column name="creatorrep_id" type="int8"/>

            <column name="description" type="VARCHAR(255)"/>
            <column name="dictionary" type="VARCHAR(255)"/>
            <column name="multiple" type="bool" defaultValueBoolean="false" />
            <column name="selectable" type="bool" defaultValueBoolean="false" />
            <column name="name" type="VARCHAR(128)"/>
            <column name="type" type="int4" defaultValueNumeric="0" />
            <column name="parent_id" type="int8"/>
            <column name="alias" type="varchar(128)"/>
            
        </createTable>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-19">
        <createTable schemaName="public" tableName="app_property_value">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_property_value_pkey"/>
            </column>
            <column defaultValueBoolean="false" name="objectdeleted" type="bool"/>
            <column defaultValueBoolean="false" name="uitagattention" type="bool"/>
            <column defaultValueBoolean="false" name="uitagmandatory" type="bool"/>
            <column defaultValueNumeric="0" name="objectstatus" type="int4">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(128)"/>
            <column name="objectid" type="int8"/>
            <column name="objecttype" type="VARCHAR(255)"/>
            <column name="additionaldictinfo" type="VARCHAR(255)"/>
            <column defaultValueNumeric="0" name="tagcount" type="int4"/>
            <column name="property_id" type="int8"/>
            <column name="owner_id" type="int8"/>
            <column name="creator_id" type="int8"/>
            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>
            <column defaultValueNumeric="0" name="searchstatus" type="int4"/>
            <column name="creatorrep_id" type="int8"/>
            <column name="alias" type="varchar(128)"/>
            <column name="additionaldictinfo2" type="varchar(255)"/>
        </createTable>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-20">
        <createTable schemaName="public" tableName="app_tag">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_tag_pkey"/>
            </column>
            <column defaultValueBoolean="false" name="objectdeleted" type="bool"/>
            <column defaultValueNumeric="0" name="objectstatus" type="int4">
                <constraints nullable="false"/>
            </column>
            <column name="objectid" type="int8"/>
            <column name="objecttype" type="VARCHAR(255)"/>
            <column defaultValueNumeric="0" name="type" type="int4">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(128)"/>
            <column name="value" type="VARCHAR(128)"/>
            <column name="owner_id" type="int8"/>
            <column name="creator_id" type="int8"/>
            <column name="categoryvalue_id" type="int8">
                <constraints nullable="false"/>
            </column>
            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>
            <column defaultValueNumeric="0" name="searchstatus" type="int4"/>
            <column name="creatorrep_id" type="int8"/>
        </createTable>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-21">
        <createTable schemaName="public" tableName="app_property2category">
            <column name="id" type="int8">
                <constraints nullable="false" primaryKey="true" primaryKeyName="app_property2category_pkey"/>
            </column>
            <column name="ptype_id" type="int8">
                <constraints nullable="false"/>
            </column>
            <column name="ctype_id" type="int8">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="position" type="int4"/>
            <column defaultValueBoolean="false" name="objectdeleted" type="bool"/>
            <column defaultValueNumeric="0" name="objectstatus" type="int4">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(128)"/>
            <column name="rootid" type="int8"/>
            <column name="rootobject" defaultValueBoolean="false" type="bool"/>
            <column name="language_id" type="int8"/>
            <column name="deletiondate" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="remover_id" type="int8"/>
            <column defaultValueNumeric="0" name="searchstatus" type="int4"/>
        </createTable>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-22">
        <!--app_category-->
        <addForeignKeyConstraint baseColumnNames="owner_id" baseTableName="app_category"
                                 baseTableSchemaName="public"
                                 constraintName="fk586465e8106f1cce"
                                 deferrable="false"
                                 initiallyDeferred="false" referencedColumnNames="id" referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="creator_id" baseTableName="app_category"
                                 baseTableSchemaName="public"
                                 constraintName="fk586465e8ff8470b5"
                                 deferrable="false"
                                 initiallyDeferred="false" referencedColumnNames="id" referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="parent_id"
                                 baseTableName="app_category"
                                 baseTableSchemaName="public"
                                 constraintName="fk586465e8ec2e41a3"
                                 deferrable="false"
                                 initiallyDeferred="false" referencedColumnNames="id"
                                 referencedTableName="app_category"
                                 referencedTableSchemaName="public"/>

    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-23">
        <!--app_property-->
        <addForeignKeyConstraint baseColumnNames="creatorrep_id"
                                 baseTableName="app_property"
                                 baseTableSchemaName="public"
                                 constraintName="app_property_creatorrep_id"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="owner_id"
                                 baseTableName="app_property"
                                 baseTableSchemaName="public"
                                 constraintName="fk75ad783d106f1cce"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="creator_id"
                                 baseTableName="app_property"
                                 baseTableSchemaName="public"
                                 constraintName="fk75ad783dff8470b5"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="parent_id"
                                 baseTableName="app_property"
                                 baseTableSchemaName="public"
                                 constraintName="fk75ad783d8d3c0e44"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_property"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="language_id" baseTableName="app_property"
                                 baseTableSchemaName="public"
                                 constraintName="fk_propertylang"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_language"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="remover_id"
                                 baseTableName="app_property"
                                 baseTableSchemaName="public"
                                 constraintName="fk_propertyremover"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-24">
        <!--tag-->
        <addForeignKeyConstraint baseColumnNames="creatorrep_id"
                                 baseTableName="app_tag"
                                 baseTableSchemaName="public"
                                 constraintName="app_tag_creatorrep_id"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="categoryvalue_id"
                                 baseTableName="app_tag"
                                 baseTableSchemaName="public"
                                 constraintName="fkd0b2707cd99eab84"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_property_value"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="owner_id"
                                 baseTableName="app_tag"
                                 baseTableSchemaName="public"
                                 constraintName="fkd0b2707c106f1cce"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="creator_id"
                                 baseTableName="app_tag"
                                 baseTableSchemaName="public"
                                 constraintName="fkd0b2707cff8470b5"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-25">
        <!--app_property_value-->
        <addForeignKeyConstraint baseColumnNames="owner_id"
                                 baseTableName="app_property_value"
                                 baseTableSchemaName="public"
                                 constraintName="fk4012c8ce106f1cce"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="creator_id"
                                 baseTableName="app_property_value"
                                 baseTableSchemaName="public"
                                 constraintName="fk4012c8ceff8470b5"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="property_id"
                                 baseTableName="app_property_value"
                                 baseTableSchemaName="public"
                                 constraintName="fk4012c8ce441886f6"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_property"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="language_id"
                                 baseTableName="app_property_value"
                                 baseTableSchemaName="public"
                                 constraintName="fk_categoryvaluelang"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_language"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="remover_id"
                                 baseTableName="app_property_value"
                                 baseTableSchemaName="public"
                                 constraintName="fk_categoryvalueremover"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="creatorrep_id"
                                 baseTableName="app_property_value"
                                 baseTableSchemaName="public"
                                 constraintName="app_property_value_creatorrep_id"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_user"
                                 referencedTableSchemaName="public"/>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-26">
        <!--app_property2category-->
        <addForeignKeyConstraint baseColumnNames="ptype_id"
                                 baseTableName="app_property2category"
                                 baseTableSchemaName="public"
                                 constraintName="fk6bb7175db07212a3"
                                 deferrable="false" initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_category"
                                 referencedTableSchemaName="public"/>
        <addForeignKeyConstraint baseColumnNames="ctype_id"
                                 baseTableName="app_property2category"
                                 baseTableSchemaName="public"
                                 constraintName="fk6bb7175db1097f1"
                                 deferrable="false" initiallyDeferred="false"
                                 referencedColumnNames="id"
                                 referencedTableName="app_property"
                                 referencedTableSchemaName="public"/>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-27">

        <!--app_category indexes-->
        <createIndex tableName="app_category" indexName="app_category_idx1" tablespace="ksdb_idx">
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="deletiondate"/>
        </createIndex>
        <createIndex tableName="app_category" unique="true" indexName="app_category_idx2" tablespace="ksdb_idx">
            <column name="lower(name)"/>
            <column name="parent_id"/>
            <column name="objectdeleted"/>
            <column name="language_id"/>
        </createIndex>
        <createIndex tableName="app_category" indexName="app_category_idx4" unique="true" tablespace="ksdb_idx">
            <column name="rootid"/>
            <column name="rootobject"/>
            <column name="language_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-28">
        <!--app_property indexes-->
        <createIndex tableName="app_property" unique="true"
                     indexName="app_property_idx1" tablespace="ksdb_idx">
            <column name="lower(name)"/>
            <column name="type"/>
            <column name="parent_id"/>
            <column name="objectdeleted"/>
            <column name="language_id"/>
        </createIndex>
        <createIndex tableName="app_property" indexName="app_property_idx2" tablespace="ksdb_idx">
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="deletiondate"/>
        </createIndex>
        <createIndex tableName="app_property" indexName="app_property_idx3" tablespace="ksdb_idx">
            <column name="multiple"/>
        </createIndex>
        <createIndex tableName="app_property" indexName="app_property_idx4" tablespace="ksdb_idx">
            <column name="type"/>
        </createIndex>
        <createIndex tableName="app_property" indexName="app_property_idx5" unique="true" tablespace="ksdb_idx">
            <column name="rootid"/>
            <column name="rootobject"/>
            <column name="language_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-29">
        <!-- app_property_value indexes -->
        <createIndex tableName="app_property_value"
                     indexName="app_property_value_idx1"
                     tablespace="ksdb_idx" unique="true">
            <column name="lower(name)"/>
            <column name="property_id"/>
            <column name="objectdeleted"/>
            <column name="language_id"/>
        </createIndex>
        <createIndex tableName="app_property_value"
                     indexName="app_property_value_idx2"
                     tablespace="ksdb_idx">
            <column name="objectdeleted"/>
            <column name="objectstatus"/>
            <column name="deletiondate"/>
        </createIndex>
        <createIndex tableName="app_property_value"
                     indexName="app_property_value_idx3"
                     unique="true" tablespace="ksdb_idx">
            <column name="rootid"/>
            <column name="rootobject"/>
            <column name="language_id"/>
        </createIndex>
        <createIndex tableName="app_property_value"
                     indexName="app_property_value_idx4"
                     tablespace="ksdb_idx">
            <column name="uitagattention"/>
            <column name="uitagmandatory"/>
        </createIndex>
        <createIndex tableName="app_property_value"
                     indexName="app_property_value_idx6"
                     tablespace="ksdb_idx">
            <column name="objecttype"/>
            <column name="objectid"/>
        </createIndex>
        <createIndex tableName="app_property_value"
                     indexName="app_property_value_addinfo2_idx1"
                     tablespace="ksdb_idx"
                     unique="false">
            <column name="additionaldictinfo2"/>
        </createIndex>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-30">
        <!-- app_tag indexes -->
        <createIndex tableName="app_tag" indexName="app_tag_idx1" tablespace="ksdb_idx">
            <column name="objecttype"/>
            <column name="objectid"/>
        </createIndex>
        <createIndex tableName="app_tag" indexName="app_tag_idx2" tablespace="ksdb_idx">
            <column name="type"/>
        </createIndex>
        <createIndex tableName="app_tag" indexName="app_tag_idx3" unique="true" tablespace="ksdb_idx">
            <column name="rootid"/>
            <column name="language_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="ezhulkov" id="1.1.0-31">
        <addColumn tableName="app_shop">
            <column name="weekmark" type="boolean" defaultValueBoolean="false"/>
            <column name="searchcommercialdatestart" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="searchcommercialdatefinish" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="searchprioritydatestart" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="searchprioritydatefinish" type="TIMESTAMP WITH TIME ZONE"/>
        </addColumn>
    </changeSet>

    <changeSet author="ahomyakov" id="1.1.0-32">
        <sql>
            ALTER TABLE app_property2category RENAME ptype_id  TO category_id;
            ALTER TABLE app_property2category RENAME ctype_id  TO property_id;               
        </sql>
    </changeSet>
</databaseChangeLog>